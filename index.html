<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¯Ø±Ø¯Ø´Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù…Ø¹ Ø¨Ø«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <style>
    /* Global Styles */
    #chat-container, #chat-container *, #usersBox, #usersBox *, #setVideoModal, #setVideoModal * {
        font-family: serif !important; text-shadow: none !important; font-size: 15.2px !important;
        line-height: 1.4 !important; font-weight: 700 !important;
    }
    .btn-primary, .btn-primary:hover, .btn-primary:focus {
        background-color: #1A4B82 !important; background-image: none; color: white; border-color: #1A4B82;
    }
    
    /* Layout */
    html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; }
    body { font-family: 'Tajawal', sans-serif; background: #f4f7f9; display: flex; flex-direction: column; position: relative; }
    #chat-container { display: flex; flex-direction: column; height: 100%; }
    
    /* Messages Area */
    #messages { flex: 1; overflow-y: auto; padding: 10px; background: #fff; direction: ltr; position: relative; }
    .msg-wrapper { border-bottom: 1px solid lavender; padding-bottom: 4px; margin-bottom: 4px; }
    .msg, .hmsg { display: flex; width: 100%; background-color: #ffffff; }
    .hmsg.notification { background-color: linen !important; }
    .u-pic { max-height: 52px !important; min-width: 52px; width: 52px; object-fit: cover; }
    .msg-content-fill { flex: 1; overflow: hidden; padding: 1px 4px 0 4px; }
    .msg-header { width: 100%; display: flex; height: 21px; align-items: center; justify-content: space-between; }
    .user-info-wrapper { display: flex; flex-grow: 1; overflow: hidden; }
    .u-topic { color: black !important; background-color: transparent !important; padding: 1px 0; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
    .u-msg { padding: 2px 1px 2px 5px; width: 100%; word-wrap: break-word; }
    .tago, .time { padding: 0 2px; margin-left: 4px; color: grey; font-size: 11px !important; white-space: nowrap; font-weight: normal !important; }
    .delete-btn { cursor: pointer; color: white; background-color: #e74c3c; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px !important; opacity: 0; transition: opacity 0.2s; }
    .msg:hover .delete-btn { opacity: 1; }
    #loading-spinner { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #888; font-size: 16px !important; }

    /* Input Area & Indicators */
    #typing-indicator { height: 20px; padding: 0 15px; font-size: 13px !important; color: #888; font-style: italic; transition: opacity 0.3s; }
    #inputArea { display: flex; flex-direction: row; align-items: center; gap: 5px; border-top: 1px solid #ddd; padding: 6px; background: #fafafa; height: 48px; box-sizing: border-box; }
    #messageInput { flex: 1; padding: 8px 12px; border: 1px solid #ccc; border-radius: 4px; outline: none; background-color: #f0f2f5; height: 100%; box-sizing: border-box; }
    #sendBtn { padding: 0 15px; cursor: pointer; height: 100%; box-sizing: border-box; border: none; border-radius: 2px; display: flex; align-items: center; justify-content: center; gap: 8px; }

    /* Top Buttons, Modals, Video Player */
    #topButtons { position: fixed; top: 10px; right: 10px; display: flex; gap: 8px; z-index: 1000; }
    .btn { padding: 6px 10px; background: white; border: 1px solid #ccc; border-radius: 20px; cursor: pointer; font-size: 16px !important; line-height: 1; display: flex; align-items: center; gap: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    #usersBox { position: fixed; top: 55px; right: 10px; background: white; border: 1px solid #ccc; border-radius: 8px; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 999; min-width: 160px; max-width: 200px; opacity: 0; transform: translateY(-10px); visibility: hidden; transition: opacity 0.2s ease, transform 0.2s ease, visibility 0.2s; }
    #usersBox.visible { opacity: 1; transform: translateY(0); visibility: visible; }
    #usersList { max-height: 200px; overflow-y: auto; }
    .user-item { display: flex; align-items: center; gap: 8px; padding: 5px 2px; border-bottom: 1px solid #f0f0f0; }
    .status-indicator { width: 10px; height: 10px; border-radius: 50%; }
    .status-green { background-color: #28a745; }
    .status-yellow { background-color: #ffc107; }
    #setVideoModal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1003; display: none; width: 90%; max-width: 400px; }
    #setVideoModal h4 { margin-top: 0; }
    #videoUrlInput { width: 100%; padding: 10px; margin: 10px 0; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box; }
    #submitVideoUrlBtn { width: 100%; padding: 10px; }
    #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1001; display: none; }
    #pinnedVideoPlayer { position: fixed; top: 50px; left: 50px; width: clamp(300px, 90vw, 450px); background: #000; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.4); z-index: 998; display: none; flex-direction: column; }
    .video-header { background-color: #1A4B82; color: white; padding: 5px 10px; border-top-left-radius: 7px; border-top-right-radius: 7px; cursor: move; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; touch-action: none; }
    .video-body { width: 100%; background: #000; }
    .video-body iframe, .video-body video { width: 100%; height: 100%; border: none; display: block; }
    .close-pinned-video { background: #e74c3c; border: 1px solid #c0392b; color: white; border-radius: 50%; width: 22px; height: 22px; cursor: pointer; font-size: 14px !important; line-height: 20px; text-align: center; }
    .video-selector { display: flex; gap: 5px; padding: 5px; background: #e9ecef; border-bottom-left-radius: 7px; border-bottom-right-radius: 7px; flex-shrink: 0; }
    .video-selector button { flex: 1; padding: 5px; background: #fff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
    .video-selector button.active { background-color: #1A4B82; color: white; border-color: #1A4B82; }
  </style>
</head>
<body>
  <div id="chat-container">
    <div id="topButtons">
        <div class="btn" id="setVideoBtn" title="ØªØ«Ø¨ÙŠØª ÙÙŠØ¯ÙŠÙˆ">ğŸ“º</div>
        <div class="btn" id="onlineListBtn" title="Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†">ğŸ‘¥ <span id="count">0</span></div>
    </div>
    <div id="usersBox"><h4>Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ø¢Ù†</h4><div id="usersList"></div></div>
    <div id="setVideoModal">
        <h4>ØªØ«Ø¨ÙŠØª ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ø¬Ù…ÙŠØ¹</h4>
        <input type="text" id="videoUrlInput" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ØŒ ØªÙˆÙŠØªØ±ØŒ M3UØŒ Ø£Ùˆ MP4"/>
        <button id="submitVideoUrlBtn" class="btn-primary">ØªØ«Ø¨ÙŠØª</button>
    </div>
    <div id="overlay"></div>
    <div id="pinnedVideoPlayer"></div>
    <div id="messages">
        <div id="loading-spinner">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„...</div>
    </div>
    <div id="typing-indicator"></div>
    <form id="inputArea" action="javascript:void(0);">
      <button type="submit" id="sendBtn" class="btn-primary" aria-label="Ø¥Ø±Ø³Ø§Ù„">
        Ø¥Ø±Ø³Ø§Ù„ <i class="fa fa-paper-plane-o"></i>
      </button>
      <input type="text" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." autocomplete="off" aria-label="Ø­Ù‚Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©"/>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const firebaseConfig = {
        apiKey: "AIzaSyB1AsEHXP05nQ8M66jYPusheLaE60q_JwU",
        authDomain: "mychat-2d881.firebaseapp.com",
        databaseURL: "https://mychat-2d881-default-rtdb.firebaseio.com",
      };
      
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const username = "Ø²Ø§Ø¦Ø±_" + Math.floor(Math.random() * 1000);
      const sessionUid = 'uid_' + Date.now() + Math.random().toString(36).substr(2, 9);
      
      const messagesDiv = document.getElementById("messages");
      const messageInput = document.getElementById("messageInput");
      const inputAreaForm = document.getElementById("inputArea");
      const onlineListBtn = document.getElementById("onlineListBtn");
      const usersBox = document.getElementById("usersBox");
      const usersList = document.getElementById("usersList");
      const count = document.getElementById("count");
      const typingIndicator = document.getElementById("typing-indicator");
      
      const setVideoBtn = document.getElementById("setVideoBtn");
      const setVideoModal = document.getElementById("setVideoModal");
      const videoUrlInput = document.getElementById("videoUrlInput");
      const submitVideoUrlBtn = document.getElementById("submitVideoUrlBtn");
      const pinnedVideoPlayer = document.getElementById("pinnedVideoPlayer");
      const overlay = document.getElementById("overlay");
      
      const userRef = db.ref("online/" + username);
      const messagesRef = db.ref("messages");
      const onlineRef = db.ref("online");
      
      let typingTimer, serverTimeOffset = 0;
      let initialLoad = true;

      userRef.set({ lastActive: firebase.database.ServerValue.TIMESTAMP, isTyping: false });
      userRef.onDisconnect().remove();
      db.ref('.info/serverTimeOffset').on('value', snap => { serverTimeOffset = snap.val() || 0; });
      
      setInterval(() => { userRef.update({ lastActive: firebase.database.ServerValue.TIMESTAMP }); }, 30000);
      setInterval(() => {
        const now = Date.now() + serverTimeOffset; const STALE_THRESHOLD = 90 * 1000;
        onlineRef.once('value', snapshot => {
          const users = snapshot.val(); if (!users) return;
          Object.keys(users).forEach(u => { if (now - (users[u].lastActive || 0) > STALE_THRESHOLD) db.ref('online/' + u).remove(); });
        });
      }, 60000);

      function closeAllModals() {
        usersBox.classList.remove('visible');
        setVideoModal.style.display = 'none';
        overlay.style.display = 'none';
      }
      onlineListBtn.onclick = e => { e.stopPropagation(); closeAllModals(); usersBox.classList.toggle('visible'); };
      setVideoBtn.onclick = e => { e.stopPropagation(); closeAllModals(); setVideoModal.style.display = 'block'; overlay.style.display = 'block'; };
      document.onclick = closeAllModals;
      usersBox.onclick = e => e.stopPropagation();
      setVideoModal.onclick = e => e.stopPropagation();

      onlineRef.on("value", snap => {
        const onlineUsers = snap.val() || {};
        count.textContent = snap.numChildren();
        renderUsersList(onlineUsers);
        updateTypingIndicator(onlineUsers);
        if (initialLoad) {
          initialLoad = false;
        }
      });

      onlineRef.on("child_added", snap => { if (!initialLoad && snap.key !== username) showSystemMsg(`ğŸ“¥ ${snap.key} Ø¯Ø®Ù„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©`); });
      onlineRef.on("child_removed", snap => { showSystemMsg(`ğŸ“¤ ${snap.key} ØºØ§Ø¯Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©`); });
      
      inputAreaForm.onsubmit = sendMessage;
      messageInput.oninput = () => {
        clearTimeout(typingTimer);
        userRef.update({ isTyping: true, lastActive: firebase.database.ServerValue.TIMESTAMP });
        typingTimer = setTimeout(() => { userRef.update({ isTyping: false }); }, 2000);
      };

      function sendMessage() {
        clearTimeout(typingTimer);
        userRef.update({ isTyping: false });
        const text = messageInput.value.trim(); if (!text) return;
        const time = new Date().toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
        messagesRef.push().set({ user: username, text, time, uid: sessionUid });
        messageInput.value = "";
        cleanupOldMessages();
      }
      
      messagesRef.limitToLast(50).on("child_added", snap => { addMessage(snap.key, snap.val()); });
      messagesRef.on('child_removed', snap => { const el = document.getElementById('msg-' + snap.key); if (el) el.parentElement.remove(); });
      
      window.deleteMessage = function(messageKey) { messagesRef.child(messageKey).remove().catch(error => console.error("Error deleting:", error)); }
      
      function updateTypingIndicator(users) {
        const typingUsers = Object.keys(users).filter(u => users[u].isTyping && u !== username);
        if (typingUsers.length === 0) typingIndicator.textContent = '';
        else if (typingUsers.length === 1) typingIndicator.textContent = `${escapeHtml(typingUsers[0])} ÙŠÙƒØªØ¨ Ø§Ù„Ø¢Ù†...`;
        else if (typingUsers.length === 2) typingIndicator.textContent = `${escapeHtml(typingUsers[0])} Ùˆ ${escapeHtml(typingUsers[1])} ÙŠÙƒØªØ¨Ø§Ù† Ø§Ù„Ø¢Ù†...`;
        else typingIndicator.textContent = `Ø¹Ø¯Ø© Ø£Ø´Ø®Ø§Øµ ÙŠÙƒØªØ¨ÙˆÙ† Ø§Ù„Ø¢Ù†...`;
      }
      
      function renderUsersList(onlineUsersData) {
        usersList.innerHTML = ''; const now = Date.now() + serverTimeOffset; const twoMinutesAgo = now - (2 * 60 * 1000);
        Object.keys(onlineUsersData).forEach(user => {
            const userData = onlineUsersData[user]; const userItem = document.createElement("div"); userItem.className = "user-item";
            const statusIndicator = document.createElement("span"); statusIndicator.className = "status-indicator";
            if (userData.lastActive < twoMinutesAgo) { statusIndicator.classList.add('status-yellow'); } else { statusIndicator.classList.add('status-green'); }
            const userName = document.createElement("span"); userName.textContent = user;
            userItem.appendChild(statusIndicator); userItem.appendChild(userName); usersList.appendChild(userItem);
        });
      }

       function addMessage(key, { user, text, time, uid }) {
          const spinner = document.getElementById('loading-spinner');
          if (spinner) spinner.style.display = 'none';

          const wrapper = document.createElement("div");
          wrapper.className = "msg-wrapper";
          const div = document.createElement("div");
          div.className = "msg";
          div.id = 'msg-' + key;
          
          let deleteBtnHtml = '';
          if (uid === sessionUid) {
              deleteBtnHtml = `<i class="delete-btn fa fa-times" onclick="deleteMessage('${key}')" title="Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©"></i>`;
          }
          
          const defaultAvatar = "https://j.top4top.io/p_3599hmcgu1.png";

          div.innerHTML = `
              <img class="u-pic" src="${defaultAvatar}">
              <div class="msg-content-fill">
                  <div class="msg-header">
                      <div class="user-info-wrapper">
                          <span class="u-topic">${escapeHtml(user)}</span>
                      </div>
                      <div style="display: flex; align-items: center;">
                         <span class="time">${escapeHtml(time)}</span>
                         ${deleteBtnHtml}
                      </div>
                  </div>
                  <div class="u-msg">${escapeHtml(text)}</div>
              </div>`;
          wrapper.appendChild(div);
          messagesDiv.appendChild(wrapper);
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }
      
      function cleanupOldMessages() {
        messagesRef.once('value', snapshot => {
          if (snapshot.numChildren() > 50) {
            let updates = {}; let count = 0; const limit = snapshot.numChildren() - 50;
            snapshot.forEach(child => { if (count < limit) updates[child.key] = null; count++; });
            messagesRef.update(updates);
          }
        });
      }
      
      function showSystemMsg(fullText) {
        const wrapper = document.createElement("div");
        wrapper.className = "msg-wrapper";
        const div = document.createElement("div");
        div.className = "hmsg notification";
        const parts = fullText.split(' ');
        const notificationUser = escapeHtml(parts[1] || 'Ù†Ø¸Ø§Ù…');
        const notificationText = escapeHtml(parts.slice(2).join(' '));
        const time = new Date().toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' });
        const defaultAvatar = "https://j.top4top.io/p_3599hmcgu1.png";
        div.innerHTML = `
            <img class="u-pic" src="${defaultAvatar}">
            <div class="msg-content-fill">
                <div class="msg-header">
                    <div class="user-info-wrapper">
                        <span class="u-topic">${notificationUser}</span>
                    </div>
                    <span class="tago">(${time})</span>
                </div>
                <div class="u-msg">${notificationText}</div>
            </div>`;
        wrapper.appendChild(div);
        messagesDiv.appendChild(wrapper);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
        setTimeout(() => {
          wrapper.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          wrapper.style.opacity = '0';
          wrapper.style.transform = 'translateY(-20px)';
          wrapper.addEventListener('transitionend', () => wrapper.remove());
        }, 4000);
      }

      function escapeHtml(unsafe) { return unsafe.toString().replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }
      
      function makeDraggable(element, handle) { let offsetX = 0, offsetY = 0; let isDragging = false; const getPointerPosition = (e) => e.touches ? e.touches[0] : e; const onDragStart = (e) => { isDragging = true; const pointer = getPointerPosition(e); offsetX = pointer.clientX - element.offsetLeft; offsetY = pointer.clientY - element.offsetTop; document.addEventListener('mousemove', onDragMove); document.addEventListener('touchmove', onDragMove, { passive: false }); document.addEventListener('mouseup', onDragEnd); document.addEventListener('touchend', onDragEnd); }; const onDragMove = (e) => { if (isDragging) { e.preventDefault(); const pointer = getPointerPosition(e); element.style.left = (pointer.clientX - offsetX) + "px"; element.style.top = (pointer.clientY - offsetY) + "px"; } }; const onDragEnd = () => { isDragging = false; document.removeEventListener('mousemove', onDragMove); document.removeEventListener('touchmove', onDragMove); document.removeEventListener('mouseup', onDragEnd); document.removeEventListener('touchend', onDragEnd); }; handle.addEventListener('mousedown', onDragStart); handle.addEventListener('touchstart', onDragStart, { passive: false }); }
      function getYoutubeVideoId(url) { if (!url) return null; const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/; return (url.match(regex) || [])[1] || null; }
      function getTweetId(url) { if (!url) return null; const regex = /(?:https?:\/\/)?(?:www\.)?(?:twitter|x)\.com\/(?:\w+)\/status\/(\d+)/; return (url.match(regex) || [])[1] || null; }
      function isDirectVideo(url) { return /\.(mp4|webm|ogv)$/.test(url); }

      submitVideoUrlBtn.onclick = () => {
          const url = videoUrlInput.value.trim(); if (!url) return;
          const youtubeId = getYoutubeVideoId(url); const tweetId = getTweetId(url);
          if (youtubeId) { db.ref("pinned_video").set({ type: 'youtube', id: youtubeId, setBy: username }); } 
          else if (tweetId) { db.ref("pinned_video").set({ type: 'twitter', id: tweetId, setBy: username }); } 
          else if (url.toLowerCase().includes('.m3u')) { db.ref("pinned_video").set({ type: 'm3u', url: url, setBy: username }); } 
          else if (isDirectVideo(url)) { db.ref("pinned_video").set({ type: 'direct', url: url, setBy: username }); } 
          else { alert("Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…."); return; }
          closeAllModals();
      };
      
      db.ref("pinned_video").on("value", async (snap) => {
          const data = snap.val(); pinnedVideoPlayer.innerHTML = '';
          if (data) {
              pinnedVideoPlayer.style.display = 'flex';
              const header = document.createElement('div'); header.className = 'video-header'; header.innerHTML = `<span>Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</span>`;
              const closeBtn = document.createElement('button'); closeBtn.className = 'close-pinned-video'; closeBtn.innerHTML = 'âœ–'; closeBtn.onclick = () => db.ref("pinned_video").remove();
              header.appendChild(closeBtn);
              const body = document.createElement('div'); body.className = 'video-body';
              pinnedVideoPlayer.appendChild(header); pinnedVideoPlayer.appendChild(body);
              makeDraggable(pinnedVideoPlayer, header);
              const createAndAppendVideo = (src, aspectRatio = "16 / 9") => {
                  const video = document.createElement('video'); video.src = src; video.controls = true; video.autoplay = true; video.muted = true;
                  video.style.aspectRatio = aspectRatio; video.setAttribute('playsinline', '');
                  if (src.includes('.m3u') && typeof Hls !== 'undefined' && Hls.isSupported()) {
                      const hls = new Hls(); hls.loadSource(src); hls.attachMedia(video);
                  }
                  body.appendChild(video); return video;
              };
              if (data.type === 'youtube') { body.innerHTML = `<iframe src="https://www.youtube.com/embed/${data.id}?autoplay=1&mute=1" allow="autoplay; encrypted-media" allowfullscreen style="aspect-ratio: 16 / 9;"></iframe>`; } 
              else if (data.type === 'm3u' || data.type === 'direct') { createAndAppendVideo(data.url); } 
              else if (data.type === 'twitter') {
                  try {
                      const response = await fetch(`https://api.vxtwitter.com/i/status/${data.id}`); const tweetData = await response.json(); const mediaItems = tweetData.media_extended;
                      if (mediaItems && mediaItems.length > 0) {
                          const playMedia = (mediaItem, clickedButton) => {
                              body.innerHTML = ''; const aspectRatio = mediaItem.width / mediaItem.height; createAndAppendVideo(mediaItem.url, aspectRatio);
                              if (selectorContainer) { selectorContainer.querySelectorAll('button').forEach(btn => btn.classList.remove('active')); if (clickedButton) clickedButton.classList.add('active'); }
                          };
                          let selectorContainer;
                          if (mediaItems.length > 1) {
                              selectorContainer = document.createElement('div'); selectorContainer.className = 'video-selector';
                              mediaItems.forEach((item, index) => { const button = document.createElement('button'); button.innerText = `Ø§Ù„Ù…Ù‚Ø·Ø¹ ${index + 1}`; button.onclick = () => playMedia(item, button); selectorContainer.appendChild(button); });
                              pinnedVideoPlayer.appendChild(selectorContainer);
                              body.innerHTML = `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:white;font-size:14px;aspect-ratio:16/9;">Ø§Ø®ØªØ± Ù…Ù‚Ø·Ø¹Ø§Ù‹</div>`;
                          } else { playMedia(mediaItems[0], null); }
                      } else { body.innerHTML = `<p style="color:white;padding:10px;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙÙŠØ¯ÙŠÙˆ.</p>`; }
                  } catch (error) { console.error("Error fetching Twitter video:", error); body.innerHTML = `<p style="color:white;padding:10px;">Ø­Ø¯Ø« Ø®Ø·Ø£.</p>`; }
              }
              if (!initialLoad && data.setBy && data.setBy !== username) { showSystemMsg(`ğŸ“º ${data.setBy} Ù‚Ø§Ù… Ø¨ØªØ´ØºÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯`); }
          } else {
              pinnedVideoPlayer.style.display = 'none';
          }
      });
    });
  </script>

  <!-- START: Deferred Scripts for Faster Page Load -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <!-- END: Deferred Scripts -->

</body>
</html>
